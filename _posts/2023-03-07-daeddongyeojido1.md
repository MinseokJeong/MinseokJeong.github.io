---
layout: post
title: '급똥 공공화장실 지도 앱 개발기 #1 (대똥여지도)'
date: '2023-03-07T19:24:00.001+09:00'
author: MJ
tags:
modified_time: '2023-03-07T19:31:04.962+09:00'
---

  

내 주변 화장실 위치를 알려주는 지도를 만들어보려 한다.

시작하게 된 계기로는

"요즘 돈이 될만한것이 없을까?"

"도움을 주면서 돈을 벌수 있는것이 없을까?" 고민을 하면서

[공공데이터 사이트](https://www.data.go.kr/)를 훑어보는 와중에

[공공화장실정보](https://www.localdata.go.kr/lif/lifeCtacDataView.do) 데이터를 발견했다.

  

[과민성대장증후군](http://www.snuh.org/health/nMedInfo/nView.do?category=DIS&medid=AA000296) 을 17년도부터 겪고있는 나로서는 너무나 반가운 데이터다.

그래서 만들어보기로 한다.

  

**_대똥여지도 를..._**

  

대똥여지도를 네이버에 검색해보니,

누군가가 이미 언급한적이 있고 실제로 나와 비슷한 이유로

만든것을 본적이있다. ([참고사이트](https://velog.io/@pccommen/%EB%8C%80%EB%98%A5%EC%97%AC%EC%A7%80%EB%8F%84))

  

나 자신에게 유용하게 사용될것같은 프로그램을 지금 만들어보려고한다.

  

만들려고하는 프로젝트를 간략하게 설명해보자면 

현재 내주변에 가까운 공공화장실 위치를 알려주는 것으로

일단 간단하게 제작하려고한다.

  

공중화장실 정보는 위에 링크를 걸어둔 공공화장실 정보를 이용하려고한다.

프로그램의 형태는 현재 flutter를 이용하여 모바일 프로그램으로 제작하려고한다.

핵심기능은 하나밖에 없다.

**\*내 근처 공공화장실 위치를 지도상에서 보여준다.\***

  

공공화장실정보 데이터를 간략하게 스크린샷으로 첨부한다.

![](/assets/images/2023/03/07/1.png)  

일단 프로젝트를 만들자.

프로젝트 명은 대똥여지도 다.

대동여지도를 구글에 영어로 검색하니 Daedongyeojido로 나온다.

그렇다면 프로젝트 명은 영어로 Daeddongyeojido로 d를 하나 더추가해서 짓는다.


![](/assets/images/2023/03/07/2.png)  

터미널을 열고 프로젝트를 생성하자.

\>> flutter create daeddongyeojido


![](/assets/images/2023/03/07/3.png)  
공공데이터 홈페이지에서 데이터를 각 지역별 데이터를 엑셀형태 파일로제공해서 전부 다운로드 완료.


![](/assets/images/2023/03/07/4.png)  

공공화장실정보 데이터를 하나의 db파일로 만들어야 한다.

  

db는 모바일 프레임워크 환경 양사(안드로이드,iOS)에서 정식 지원하는 sqlite를 사용할 것이다.

  

먼저 위 다운로드 받은 excel파일들을 하나의 db로 만드는게 필요하다.

하나의 db로 만들기위해서 파이썬을 사용할 예정.

파이썬으로 쉽게 excel파일을 임포트 할수 있다. (수많은 유용한 패키지들을 만들어주신 개발자분들에게 감사드립니다.)

  

엑셀파일을 읽을수만 있으면 되기 때문에 구글에 python excel pacakge로 검색후, 가장 첫번째로 보이는 패키지로 결정. (OpenPyXL)

![](/assets/images/2023/03/07/5.png)  

이제 위 패키지를 사용하여 엑셀파일을 읽을수 있는지 테스트 코드를 작성.

  

그전에 파이썬 문법도 가물가물해서 구글링하면서 코드 작성중.

또한 OpenPyXL 패키지를 어떻게 사용해야 되는지 모르기때문에 홈페이지에 접속해서 문서를 읽으면서 필요한 기능을 찾아보면서 개발하고있다.

  
![](/assets/images/2023/03/07/6.png)  
현재 파일의 각셀에 들어가있는 정보를 읽을수 있도록

  

엑셀파일의 정보는 총 31개의 데이터가 제공된다.

  

1.  번호
2.  구분
3.  화장실명
4.  소재지도로명주소
5.  소재지지번주소
6.  남녀공용화장실여부
7.  남성용-대변기수
8.  남성용-소변기수
9.  남성용-장애인용대변기수
10.  남성용-장애인용소변기수
11.  남성용-어린이용대변기수
12.  남성용-어린이용소변기수
13.  여성용-대변기수
14.  여성용-장애인용대변기수
15.  여성용-어린이용대변기수
16.  관리기관명
17.  전화번호
18.  개방시간
19.  설치연월
20.  WGS84위도
21.  WGS84경도
22.  화장실소유구분
23.  화장실설치장소유형
24.  오물처리방식
25.  비상벨설치여부
26.  비상벨설치장소
27.  화장실입구CCTV설치유무
28.  기저귀교환대유무
29.  기저귀교환대장소
30.  리모델링연월
31.  데이터기준일자

이중 필요한 데이터만 뽑아보자.

  

위에서 현재 필요하다고 생각하는 정보만 추출해봤다.

1.  구분
2.  화장실명
3.  소재지도로명주소
4.  소재지지번주소
5.  관리기관명
6.  전화번호
7.  개방시간
8.  화장실소유구분
9.  화장실설치장소유형
10.  비상벨설치여부
11.  비상벨설치장소
12.  화장실입구CCTV설치유무
13.  데이터기준일자

여기에 추가로 더해야 할것은, GPS 좌표 다.

엑셀파일에서 WGS84위도, WGS84경도 열이 존재함에도, 

대부분 데이터가 없고 비워져 있다.

직접 소재지도로명주소와, 소재지지번주소에서 좌표를 얻어 저장할 필요가 있다.

<br/>
<br/>
---  
<br/>
<br/>
<br/>

지금 주소를 가지고 좌표를 얻기위해서, [네이버 지도 geocode api](https://guide.ncloud-docs.com/docs/ko/naveropenapiv3-maps-geocoding-geocoding)를 이용해서 좌표 값을 얻으려 한다.

[네이버 클라우드 콘솔 플랫폼](https://console.ncloud.com/) 에 접속해서 api를 활용하기 위해 프로젝트를 만들고, 클라이언트 ID와, 클라이언트 시크릿 값을 기억해둔다.

rest형식의 api를 사용하기 위해서, 두값이 필요하다.

  

![](/assets/images/2023/03/07/7.png)  

파이썬을 활용하여 좌표값을 얻을것인데 http 통신관련 패키지로 [requests](https://requests.readthedocs.io/en/latest/) 패키지를 이용할 생각이다. 몇년전 파이썬관련 크롤링 작업을 할때 위 패키지를 사용했었던 것같기도..

  

간단하게 어떻게 사용하는지 quick start 가이드를 훑어보고 코딩을 시작.

네이버 api를 활용하기위해 http통신 프로토콜의 헤더에 저장해두었던 두 클라이언트ID와, 시크릿 값을 입력하고, query 파라미터에 주소를 입력후 간단하게 테스트 해보았더니 작동이 된다. ([네이버 geocode 문서 참조](https://api.ncloud-docs.com/docs/ai-naver-mapsgeocoding))

  

  

이제 파이썬의 한 모듈로 주소를 입력하면 gps 좌표를 반환하도록 코드를 작성.

![](/assets/images/2023/03/07/8.png)  


현재 공공데이터로 제공되는 화장실 갯수를 살펴보니 46,273 개의 정보가 공개 되어있다.

아래는 총 갯수가 얼마나 되나 궁금해서 만든 코드..

![](/assets/images/2023/03/07/9.png)  
  



---
  
  
  
파이썬 으로 파일을 읽어서 각행별로 주소를 읽어다가 네이버 geocode 클라우드 api 를 활용하여 gps position을 가져와 database를 구축하는 도중, 잘 진행되다가 아래와 같은 error로 중간에 멈추는 상황 발생.  

![](/assets/images/2023/03/07/10.png)  

응답받은 json에 meta라는 항목이 없어서 생긴 문제 였다.

meta라는 항목이 없으면 넘어가게끔 코드를 수정하자. 

getGpsPosition 함수 내부에 try except 코드로 감싸주어 예외처리를 처리하도록 하였음.

  

현재 만들어진 db를 들여다 보니, 15,000 여개의 데이터가 이미 저장이 되어있어서,

서울 지역에서 에러가 발생했으니, db중에 서울데이터들은 제거 해주고, 이미 저장된 지역들의 파일들은 건너뛰게 한후에, 진행하려고 한다.

전라남도, 세종특별시, 인천광역시, 부산광역시, 충청남도, 경상남도 파일은 이미 저장되었으니, 파일명중에 위의 단어가 들어가있으면 건너뛰고 다음 파일을 작업하도록 작업했다.

  

아래는 gps 정보를 모으고있는 터미널 상황을 캡쳐해보았다.

![](/assets/images/2023/03/07/11.gif)  


GIF파일로 만들기 위해서, [GIPHY CAPTURE](https://giphy.com/apps/giphycapture) 라는 프로그램을 이용하여 녹화함.

일단 데이터가 다운로드 다될때까지는, 잠시 시간을 가져야겠다.

  

이제 남은 일이라고는 모바일 단말기에서 GPS를 통해서 가지고온 위치좌표(현재위치)와 가까운 화장실 정보를 가져올수있도록 하는 기능을 작성해야함.

현 gps좌표로부터 상,하,좌,우 일정 거리에 들어있는 데이터를 가져오도록 해서 프린트 해보자.

일단 두 gps 좌표로부터 거리를 계산 하기위해서 거리 계산 식을 알아야 하는데, 인터넷에 gps 거리 계산 관련 웹사이트가 많아서 그중 하나에 들어가 개발자모드로 웹사이트에 자바스크립트로 쓰여진 계산 관련 식을 살펴보았다.

![](/assets/images/2023/03/07/12.png)  
 

일단 두 gps 좌표 사이의 거리를 계산하는 함수는 위의 사이트를 참고하여 작성.

  

공공화장실정보 엑셀파일들의 모든 정보를 데이터베이스에 저장이 완료되었다.

![](/assets/images/2023/03/07/13.gif)
DB browser for SQLite 프로그램으로 확인

현재 내 위치를 기반으로 주변 2km의 화장실정보를 확인해서 구글맵에 gps 좌표를 찍어가면서 결과를 확인해보았다. 

노란색 마커들이 나의 중심으로부터 2km좌표들을 마커로 표시해본것이다.

![](/assets/images/2023/03/07/14.png)  

어느정도 결과가 보이는 것 같고, 일단 flutter 프로젝트로 넘어가, naver map을 활용하여 화면을 만들어보자.  

![](/assets/images/2023/03/07/15.png)  
플루터 프로젝트로 네이버 지도 기능 확인

  
  
  
flutter에서 db파일을 추가하면 db파일을 sqlite 데이터베이스를 초기화 할때 저장된 파일 경로 위치를 알려주면 될줄 알았는데, flutter assets으로 추가된 파일을 다이렉트로 접근이 안되는 것 같다.  
그래서 디비 파일을 application document 폴더로 복사하고 그다음 사용하는 형식으로 진행된다.


일단 기본적인 [네이버지도](https://pub.dev/packages/flutter_naver_map) 와, [현재위치가져오기](https://pub.dev/packages/geolocator), [데이터베이스](https://pub.dev/packages/sqflite) 각각의 관련 패키지들을 이용하여 현재 위치에서 주변 1km 이내의 화장실 정보를 마커로 표시하게끔 구현을 해보았다.

  
![](/assets/images/2023/03/07/16.png)  
현재위치 주변 반경 1km 화장실 위치 마커
  

기본적인 틀은 만들어 놓았고, 이제 UI 작업과, 미진한 기능들, 실제 모바일 환경에서 동작확인 으로 마무리 하자.