---
layout: post
title: '개인용 웹사이트 개발기 #1'
date: '2023-07-12T18:23:00.004+09:00'
author: MJ
tags: [flutter, dart]
modified_time: '2023-07-13T00:35:17.580+09:00'
category: dev
---

개발을 처음 시작할 때 부터 작성을 하려 하였는데,어느 순간 이미 개발은 완료 되고,현재 웹사이트 도메인도 사고 vercel을 이용해 배포도 한상태이다.

현재 웹사이트를 로딩시에 가장 큰 문제가 첫 화면 로딩이 오래 걸린다는 문제가 있다.

![크롬 개발자 모드로 네트워크 트래픽 확인](/assets/images/2023/07/12/a.png)

총 트래픽이 33.0 MB로 게임도 아니고 단순 웹사이트가 이렇게 많은 데이터를 소모하는게 마음에 들지 않는다.

총 네트워크 트래픽 33.0MB 중 19.4MB가 폰트 파일 크기이다.

전체 웹사이트 크기중 64%를 차지 하고 있다.

어떻게든 이 폰트 파일들의 크기를 줄이거나, 폰트를 사용하지 않는 방식으로.. 이미지화해서 하는 방식으로...  

실제로 저 폰트 파일중, NotoSansJP-Regular 파일 및 NotoSans-Regular파일은 맨처음 웹사이트를 방문시 스플래시 패이지에서 잠시 2~3초정도 안녕이라는 각 나라별 문자를 출력하는게 전부다.  

![웹사이트 스플래시 화면](/assets/images/2023/07/12/c.gif "웹사이트 스플래시화면 이다")

근데 지금 다시 확인해보니 NotoSansKR 파일이 총 4파일로 약 16MB를 차지해서 전체 폰트 파일크기중 80%를 차지한다.

일단 NotoSansJP, NotoSans 이 두폰트를 빼고 처음 splash 페이지는 이미지를 보여주는 형식으로 변경해야겠다.

![피그마로 작업](/assets/images/2023/07/12/d.png)
 원래는 인도어로 안녕도 있었는데 Figma NotoSans 폰트에서 렌더링이 안되는? 버그 문제가 있다. 구글링을 해도 현재 인도어가 출력이 안되는 문제가 있어 아랍어로 대체하였음.

![svg파일로 추출](/assets/images/2023/07/12/e.png)

각 나라별 글자를 svg로 추출하여 글자를 렌더링이 아닌 이미지를 렌더링 하는 방식으로 가자.

또한 Google Font에서 제공하는 NotoSans 말고, 용량이 적은 폰트를 찾다가,
[마루부리 폰트](https://hangeul.naver.com/font/maru)를 찾게 되었다.
![마루부리 폰트 파일들](/assets/images/2023/07/12/f.png "마루부리 폰트 파일들")

기존에 사용하고 있는 NotoSansKR 폰트파일 하나 보다 적은 사이즈로 밖에 되지 않는다.
![마루부리 폰트로 네트워크 트래픽](/assets/images/2023/07/12/h.png)

이렇게 폰트를 변경하고 나서 기존의 33.0MB 에서 10.7MB로 트래픽을 1/3 가량을 줄이긴 했지만, 디자인이 변해버렸다...

초기 설계했던 디자인은 아니지만, 일단 첫 웹사이트 로딩이 쾌적해야 사용자경험이 좋은것은 당연한것이다.

이렇게 웹사이트 로딩속도 개선을 노력은 했지만, 아직도 10.7MB로 너무 많은것은 사실이다.

어떻게 하면 첫 웹사이트 로딩을 좀더 줄일수 있을까?

인터넷을 돌아다니다가 deffered loading? 을 사용해서 좀더 잘게 페이지단위로

쪼개는 방법을 본것같은데,, 나중에 그방법을 사용해보도록하자.

____

Flutter Web으로 빌드한 결과물은, 초기 html, js 등 결과물이 브라우저에서

로딩이 되기까지 몇초의 시간이 걸리는데, 그시간동안 화면의 색상이 흰색이여서,

내가만든 웹사이트의 배경색상이랑 맞지않아, 이질적인 느낌이 있다.

또 첫 로딩까지 시간이 몇 초로 생각보다 오래 걸리는 느낌이여서,

그냥 빈화면이 덜렁 나와 당황스러운 느낌도 있다.

그래서 애초에 html 자체의 body 부분에 배경색상을,

내 앱의 배경색상과 같게 만들고,

처음 loading 되기 전까지는 html 자체 로딩 인디케이터를 보여주는 형식으로 변경하였다.  

![프로젝트 web 폴더 구조](/assets/images/2023/07/12/g.png)

프로젝트 폴더네 web 폴더안에 index.html 파일 안의 코드를 수정해준다.  

![body 태그 안에 인라인 스타일 설정](/assets/images/2023/07/12/i.png)
index.html 파일 안에 body 에 inline으로 내앱의 배경색상을 추가해서 이질감을 없앤다.

![div 로딩 엘리먼트 추가](/assets/images/2023/07/12/j.png)
flutter loading이 되기전까지 html 자체적으로 로딩 인디케이터를 보여주도록 코드를 추가함  

![script로 flutter engine이 로딩이 완료되면 div 로딩 엘리먼트를 제거](/assets/images/2023/07/12/k.png)
flutter engine 로딩이 완료되면 로딩 인디케이터를 삭제한다.
